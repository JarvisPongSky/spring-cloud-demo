version: '3.8' # compose 编排文件版本号
services: # 服务列表

  nacos1: # 服务名称
    image: nacos/nacos-server:1.4.1 # 引用镜像
    hostname: nacos1 # host 名称
    restart: always # 重启策略，docker 启动后，如果有运行此服务会自启
    ports: # 映射端口列表
      - 8841:8848 # 映射 nacos 服务端口
    environment: # 环境参数
      PREFER_HOST_MODE: hostname # 支持  hostname 模式
      NACOS_SERVERS: nacos1:8848 nacos2:8848 nacos3:8848 # 集群地址
      MYSQL_SERVICE_HOST: mysql # 数据库连接地址
      MYSQL_SERVICE_DB_NAME: cloud_nacos # 数据库库名
      MYSQL_SERVICE_USER: root # 数据库用户名
      MYSQL_SERVICE_PASSWORD: 123456 # 数据库用户密码
      MYSQL_SERVICE_DB_PARAM: characterEncoding=utf8&autoReconnect=true&serverTimezone=Asia/Shanghai&useSSL=false&connectTimeout=1000&socketTimeout=3000 # 数据库链接参数
    deploy:
      resources:
        limits: # 限制资源
          memory: 2g # 内存容量，支持单位：b、k、m、g

  nacos2: # 服务名称
    image: nacos/nacos-server:1.4.1 # 引用镜像
    hostname: nacos2 # host 名称
    restart: always # 重启策略，docker 启动后，如果有运行此服务会自启
    ports: # 映射端口列表
      - 8842:8848 # 映射 nacos 服务端口
    environment: # 环境参数
      PREFER_HOST_MODE: hostname # 支持  hostname 模式
      NACOS_SERVERS: nacos1:8848 nacos2:8848 nacos3:8848 # 集群地址
      MYSQL_SERVICE_HOST: mysql # 数据库连接地址
      MYSQL_SERVICE_DB_NAME: cloud_nacos # 数据库库名
      MYSQL_SERVICE_USER: root # 数据库用户名
      MYSQL_SERVICE_PASSWORD: 123456 # 数据库用户密码
      MYSQL_SERVICE_DB_PARAM: characterEncoding=utf8&autoReconnect=true&serverTimezone=Asia/Shanghai&useSSL=false&connectTimeout=1000&socketTimeout=3000 # 数据库链接参数
    deploy:
      resources:
        limits: # 限制资源
          memory: 2g # 内存容量，支持单位：b、k、m、g

  nacos3: # 服务名称
    image: nacos/nacos-server:1.4.1 # 引用镜像
    hostname: nacos3 # host 名称
    restart: always # 重启策略，docker 启动后，如果有运行此服务会自启
    ports: # 映射端口列表
      - 8843:8848 # 映射 nacos 服务端口
    environment: # 环境参数
      PREFER_HOST_MODE: hostname # 支持  hostname 模式
      NACOS_SERVERS: nacos1:8848 nacos2:8848 nacos3:8848 # 集群地址
      MYSQL_SERVICE_HOST: mysql # 数据库连接地址
      MYSQL_SERVICE_DB_NAME: cloud_nacos # 数据库库名
      MYSQL_SERVICE_USER: root # 数据库用户名
      MYSQL_SERVICE_PASSWORD: 123456 # 数据库用户密码
      MYSQL_SERVICE_DB_PARAM: characterEncoding=utf8&autoReconnect=true&serverTimezone=Asia/Shanghai&useSSL=false&connectTimeout=1000&socketTimeout=3000 # 数据库链接参数
    deploy:
      resources:
        limits: # 限制资源
          memory: 2g # 内存容量，支持单位：b、k、m、g


networks:
  default:
    external: true # 指定加入外部已存在网络
    name: cloud # 网络名称